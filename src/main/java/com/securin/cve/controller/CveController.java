package com.securin.cve.controller;

import com.securin.cve.model.CveModel;
import com.securin.cve.model.CveResponse;
import com.securin.cve.service.CveService;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.Parameter;
import io.swagger.v3.oas.annotations.responses.ApiResponse;
import io.swagger.v3.oas.annotations.responses.ApiResponses;
import io.swagger.v3.oas.annotations.tags.Tag;
import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.*;


@Tag(name = "CVE", description = "Api to retrieve cve data")
@RestController
@RequestMapping("/api/v1/cve")
@RequiredArgsConstructor
public class CveController {

    private final CveService cveService;

    @Operation(
            summary = "Get CVE by id",
            description = "Fetches a cve data for given id")
    @ApiResponses(value = {
            @ApiResponse(responseCode = "200", description = "successful"),
            @ApiResponse(responseCode = "404", description = "Data not found"),
            @ApiResponse(responseCode = "422", description = "Invalid input")
    })
    @GetMapping("/by-id")
    public CveModel getCveDataById(@Parameter(name = "cveId", description = "cve id", example = "CVE-2023-50685") @RequestParam String cveId) {
        return cveService.getCveDataById(cveId);
    }

    @Operation(
            summary = "Get CVE List filtered by score",
            description = "Fetches chunk of cve data list for given score")
    @ApiResponses(value = {
            @ApiResponse(responseCode = "200", description = "successful"),
            @ApiResponse(responseCode = "404", description = "Data not found"),
            @ApiResponse(responseCode = "422", description = "Invalid input")
    })
    @GetMapping("/by-score")
    public CveResponse getCveDataByScore(@Parameter(name = "score", description = "cve base score", example = "7") @RequestParam Double score,
                                         @Parameter(name = "startIndex", description = "Page number", example = "5") @RequestParam(defaultValue = "0") int pageNo,
                                         @Parameter(name = "resultsPerPage", description = "No of results required", example = "100") @RequestParam(defaultValue = "200") int resultsPerPage){
        return cveService.getCveDataByScore(score, pageNo, resultsPerPage);
    }

    @Operation(
            summary = "Get CVE List filtered by no of days from last modified date",
            description = "Fetches chunk of cve data list for given no of days")
    @ApiResponses(value = {
            @ApiResponse(responseCode = "200", description = "successful"),
            @ApiResponse(responseCode = "404", description = "Data not found"),
            @ApiResponse(responseCode = "422", description = "Invalid input")
    })
    @GetMapping("/by-lastModifiedDay")
    public CveResponse getCveDataByLast(@Parameter(name = "no. of days", description = "no of days from last modified date", example = "7") @RequestParam("noOfDays") Long lastModified,
                                        @Parameter(name = "startIndex", description = "Page number", example = "5") @RequestParam(defaultValue = "0") int pageNo,
                                        @Parameter(name = "resultsPerPage", description = "No of results required", example = "100") @RequestParam(defaultValue = "200") int resultsPerPage){
        return cveService.getCveDataByLastModifiedDays(lastModified, pageNo, resultsPerPage);
    }

}
