package com.securin.cve.config;

import com.securin.cve.service.DeDuplicationJobService;
import com.securin.cve.service.IncrementalDataMigrationService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.context.annotation.Configuration;
import org.springframework.scheduling.annotation.EnableScheduling;
import org.springframework.scheduling.annotation.Scheduled;

@Configuration
@RequiredArgsConstructor
@Slf4j
@EnableScheduling
public class JobScheduler {

    private final IncrementalDataMigrationService incrementalDataMigrationJobService;

    private final DeDuplicationJobService deDuplicationJobService;

    @Scheduled(cron = "${cve.inc-run.job.schedule}")
    public void incrementalJobRun() {
        try {
            incrementalDataMigrationJobService.runJob();
        } catch (InterruptedException e) {
            log.error("Incremental run job stopped!", e);
        }
    }

    @Scheduled(cron = "${cve.dedup.job.schedule}")
    public void deDupJobRun() {
        try {
            deDuplicationJobService.runJob();
        } catch (Exception e) {
            log.error("Dedup run job stopped!", e);
        }
    }


}
